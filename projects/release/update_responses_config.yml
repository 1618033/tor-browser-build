---
tmp_dir: '[% c("tmp_dir") %]'
create_downloads_json: 1
appname_marfile: '[% c("var/project-name") %]'
appname_bundle_android: '[% c("var/project-name") %]'
appname_bundle_macos: '[% c("var/ProjectName") %]'
appname_bundle_linux: '[% c("var/project-name") %]'
appname_bundle_win32: '[% c("var/projectname") %]-install'
appname_bundle_win64: '[% c("var/projectname") %]-install-win64'
releases_dir: [% path(c('output_dir')) %][% IF ! c("var/nightly") %]/signed[% END %]
download:
    gpg_keyring: ../../keyring/torbrowser.gpg
[% IF c("var/tor-browser") -%]
    archive_url: 'https://archive.torproject.org/tor-package-archive/torbrowser'
    bundles_url: 'https://dist.torproject.org/torbrowser'
    mars_url: 'https://cdn.torproject.org/aus1/torbrowser'
[% END -%]
[% IF c("var/mullvad-browser") -%]
    archive_url: 'https://cdn.mullvad.net/browser'
    bundles_url: 'https://cdn.mullvad.net/browser'
    mars_url: 'https://cdn.mullvad.net/browser'
[% END -%]
build_targets:
    linux32: Linux_x86-gcc3
    linux64: Linux_x86_64-gcc3
    win32:
        - WINNT_x86-gcc3
        - WINNT_x86-gcc3-x86
        - WINNT_x86-gcc3-x64
    win64: WINNT_x86_64-gcc3-x64
    macos:
      - Darwin_x86_64-gcc3
      - Darwin_aarch64-gcc3
channels:
    [% c('var/channel') %]: [% c("var/torbrowser_version") %]
versions:
    [% c("var/torbrowser_version") %]:
[% IF c("var/create_unsigned_incrementals") -%]
        releases_dir: [% path(c('output_dir')) %]/unsigned
[% END -%]
        mar_channel_id: [% c('var/mar_channel_id') %]
        platformVersion: [% pc('firefox', 'var/firefox_platform_version') %]
[% IF c("var/tor-browser") -%]
        detailsURL: https://blog.torproject.org/new-release-tor-browser-[% c("var/torbrowser_version") FILTER remove('\.') %]
[% END -%]
[% IF c("var/mullvad-browser") -%]
        detailsURL: https://github.com/mullvad/mullvad-browser/releases/[% pc('firefox', 'git_hash') %]
[% END -%]
        incremental_from:
[% SET incr_from = c("var/nightly") ? c("var_p/nightly_torbrowser_incremental_from") : c("var/torbrowser_incremental_from");
   FOREACH v IN incr_from -%]
          - [% v %]
[% END -%]
        # for example, osx32: osx64
        migrate_archs:
        # for example, pt-PT: pt-BR
        migrate_langs:
        # minSupportedOsVersion on macOS corresponds to the Darwin version ( https://en.wikipedia.org/wiki/Darwin_(operating_system) )
        macos:
            # macOS v10.12.0
            minSupportedOSVersion: 16.0.0
        # minSupportedOsVersion on Windows corresponds to the operating system version ( https://docs.microsoft.com/en-us/windows/win32/sysinfo/operating-system-version )
        win32:
            # Windows 7
            minSupportedOSVersion: 6.1
            minSupportedInstructionSet: SSE2
        win64:
            # Windows 7
            minSupportedOSVersion: 6.1
            minSupportedInstructionSet: SSE2
        linux32:
            minSupportedInstructionSet: SSE2
        linux64:
            minSupportedInstructionSet: SSE2
mar_compression: xz
tag: 'tbb-[% c("var/torbrowser_version") %]-[% c("var/torbrowser_build") %]'

[% IF c("var/tor-browser") -%]
htaccess_rewrite_rules:
    alpha: |
        # bug 26569: Redirect pre-8.0a9 alpha users to a separate update directory
        RewriteRule ^[^/]+/8\.0a[12345678]/.* https://aus1.torproject.org/torbrowser/update_pre8.0a9/alpha/$0 [last]
        RewriteRule ^[^/]+/[4567]\..*/.* https://aus1.torproject.org/torbrowser/update_pre8.0a9/alpha/$0 [last]
    release: |
        # bug 26570: Redirect pre-8.0 stable users to a separate update directory
        RewriteRule ^[^/]+/[4567]\..*/.* https://aus1.torproject.org/torbrowser/update_pre8.0/release/$0 [last]
        # tor-browser-build#40678: Force all <=11.5.7 users to update through 11.5.8 before 12.0
        RewriteRule ^[^/]+/[89]\..*/.* https://aus1.torproject.org/torbrowser/update_pre12.0/release/$0 [last]
        RewriteRule ^[^/]+/10\..*/.* https://aus1.torproject.org/torbrowser/update_pre12.0/release/$0 [last]
        RewriteRule ^[^/]+/11\.0.*/.* https://aus1.torproject.org/torbrowser/update_pre12.0/release/$0 [last]
        RewriteRule ^[^/]+/11\.5/.* https://aus1.torproject.org/torbrowser/update_pre12.0/release/$0 [last]
        RewriteRule ^[^/]+/11\.5\.[01234567]/.* https://aus1.torproject.org/torbrowser/update_pre12.0/release/$0 [last]
[% END -%]
